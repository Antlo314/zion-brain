<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Zion 2.0 | Executive Intelligence</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Space+Grotesk:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <!-- GSAP -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['Space Grotesk', 'monospace'],
          }
        }
      }
    }
  </script>

  <style>
    html, body {
      height: 100% !important;
      min-height: 100% !important;
      margin: 0 !important;
      background: #050505 !important;
      color: #fff !important;
    }
    body {
      overflow: hidden !important;
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      position: relative;
    }

    /* WebGL stage */
    #canvas-container {
      position: fixed !important;
      inset: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 0 !important;
      pointer-events: none;
      overflow: hidden;
      background:
        radial-gradient(1200px 800px at 60% 40%, rgba(99,102,241,0.12), transparent 60%),
        radial-gradient(900px 700px at 35% 70%, rgba(6,182,212,0.10), transparent 62%),
        #050505;
    }
    #canvas-container canvas {
      position: absolute !important;
      inset: 0 !important;
      width: 100% !important;
      height: 100% !important;
      display: block !important;
    }

    /* Screen effects */
    .vignette{
      position: fixed; inset: 0; pointer-events:none;
      background: radial-gradient(circle at center, rgba(0,0,0,0) 0%, #050505 120%);
      z-index: 5;
    }
    .scanlines{
      position: fixed; inset:0; pointer-events:none;
      background: linear-gradient(to bottom,
        rgba(255,255,255,0),
        rgba(255,255,255,0) 50%,
        rgba(0,0,0,0.12) 50%,
        rgba(0,0,0,0.12)
      );
      background-size: 100% 4px;
      z-index: 6;
      opacity: 0.12;
    }

    .no-scrollbar::-webkit-scrollbar{ display:none; }
    .no-scrollbar{ -ms-overflow-style:none; scrollbar-width:none; }

    /* Glass */
    .glass-panel{
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.20);
    }
    .glass-input{
      background: rgba(0, 0, 0, 0.45);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.55);
    }

    /* Badges */
    .badge{
      position: fixed;
      top: 14px;
      z-index: 30;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      font-family: 'Space Grotesk', monospace;
      font-size: 10px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.75);
      user-select: none;
    }
    .badge .dot{
      display:inline-block; width:6px; height:6px; border-radius:999px; margin-right:8px;
      transform: translateY(-1px);
    }
    .lumen-badge{ left: 14px; }
    .lumen-badge .dot{
      background: rgba(99,102,241,0.9);
      box-shadow: 0 0 18px rgba(99,102,241,0.35);
    }
    .zion-badge{ right: 14px; }
    .zion-badge .dot{
      background: rgba(6,182,212,0.9);
      box-shadow: 0 0 18px rgba(6,182,212,0.35);
    }

    /* ===== Void output (Zion reply only) ===== */
    .void-output{
      position: fixed;
      left: 0; right: 0;
      bottom: 166px;
      z-index: 26;
      pointer-events: none;
      padding: 0 16px;
    }
    @media (min-width: 768px){
      .void-output{ bottom: 170px; padding: 0 24px; }
    }
    .void-inner{ max-width: 980px; margin: 0 auto; }
    .void-label{
      display:flex; align-items:center; gap:10px;
      font-family:'Space Grotesk', monospace;
      font-size: 10px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.40);
      margin-bottom: 10px;
    }
    .void-label .p{
      width: 6px; height: 6px; border-radius: 999px;
      background: rgba(99,102,241,0.85);
      box-shadow: 0 0 18px rgba(99,102,241,0.35);
    }
    .void-text{
      font-size: 15px;
      line-height: 1.45;
      color: rgba(255,255,255,0.92);
      text-shadow:
        0 0 18px rgba(99,102,241,0.20),
        0 0 28px rgba(6,182,212,0.10);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .35s ease, transform .35s ease;
      white-space: pre-wrap;
      will-change: transform, opacity, filter;
    }
    @media (min-width: 768px){ .void-text{ font-size: 16px; } }
    .void-text.on{ opacity: 1; transform: translateY(0px); }

    /* Dock links */
    .dock-links a{
      font-family:'Space Grotesk', monospace;
      font-size: 10px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.50);
      text-decoration: none;
      transition: color .2s ease;
    }
    .dock-links a:hover{ color: rgba(255,255,255,0.92); }

    /* Desktop cards */
    .module-card{
      transition: transform .45s ease, border-color .35s ease, box-shadow .35s ease, background .35s ease;
      will-change: transform;
    }
    .module-card:hover{
      transform: translateY(-6px);
      border-color: rgba(99, 102, 241, 0.42);
      box-shadow: 0 0 34px rgba(99, 102, 241, 0.12), inset 0 0 18px rgba(6, 182, 212, 0.06);
      background: rgba(255,255,255,0.035);
    }
    .status-dot{ box-shadow: 0 0 10px currentColor; }

    /* Mobile chips */
    .chip-row{
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 10px 2px 2px;
      -webkit-overflow-scrolling: touch;
    }
    .chip-row::-webkit-scrollbar{ display:none; }
    .chip{
      flex: 0 0 auto;
      border-radius: 999px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      font-family: 'Space Grotesk', monospace;
      font-size: 11px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.78);
      box-shadow: 0 0 24px rgba(99,102,241,0.06);
      transition: transform .2s ease;
      user-select: none;
      white-space: nowrap;
    }
    .chip:active{ transform: scale(0.98); }

    /* Tip fades out when Zion responds */
    .tip-wrap{
      transition: opacity .25s ease, transform .25s ease;
      opacity: 1;
      transform: translateY(0);
    }
    .tip-wrap.tip-hidden{
      opacity: 0;
      transform: translateY(6px);
      pointer-events: none;
    }

    /* Responsive UI toggles */
    #ui-mobile{ display: block; }
    #ui-desktop{ display: none; }
    @media (min-width: 768px){
      #ui-mobile{ display: none; }
      #ui-desktop{ display: flex; }
    }

    /* Safe padding */
    .safe-bottom-pad { padding-bottom: 260px; }
    @media (min-width: 768px){ .safe-bottom-pad { padding-bottom: 220px; } }

    /* ===== Cinematic thinking dots + typed layer ===== */
    .zion-typed{ white-space: pre-wrap; letter-spacing: .01em; text-shadow: 0 10px 24px rgba(0,0,0,.35); }
    .zion-thinking{
      display:inline-flex; gap:7px; align-items:center; opacity:.9;
      filter: drop-shadow(0 6px 18px rgba(0,0,0,.35));
    }
    .zion-thinking span{
      width:6px;height:6px;border-radius:999px;
      background: rgba(248,249,252,.82);
      transform: translateY(0);
      animation: zionDot 1.15s infinite ease-in-out;
    }
    .zion-thinking span:nth-child(2){ animation-delay:.14s; opacity:.72;}
    .zion-thinking span:nth-child(3){ animation-delay:.28s; opacity:.58;}
    @keyframes zionDot{
      0%, 78%, 100%{ transform: translateY(0); }
      40%{ transform: translateY(-4px); }
    }

    /* ===== Intake Modal (scrollable + sticky actions) ===== */
    .modal-backdrop{
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.62);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 60;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
    }
    .modal-backdrop.on{ display:flex; }

    .modal-card{
      width: 100%;
      max-width: 780px;
      border-radius: 20px;
      background: rgba(10,12,16,0.62);
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: 0 30px 90px rgba(0,0,0,0.55);
      overflow: hidden;

      /* NEW: viewport safe + scroll layout */
      max-height: 86vh;
      display: flex;
      flex-direction: column;
    }
    .modal-top{
      padding: 18px 18px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display:flex; align-items:flex-start; justify-content: space-between; gap: 12px;
      flex: 0 0 auto;
    }
    .modal-title{
      font-family:'Space Grotesk', monospace;
      letter-spacing:.14em;
      text-transform: uppercase;
      font-size: 11px;
      color: rgba(255,255,255,0.72);
    }
    .modal-sub{
      margin-top: 8px;
      font-size: 14px;
      color: rgba(255,255,255,0.78);
      max-width: 44rem;
    }
    .modal-close{
      width: 40px; height: 40px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      color: rgba(255,255,255,0.85);
      display:flex; align-items:center; justify-content:center;
      cursor: pointer;
      transition: transform .18s ease, background .18s ease;
      flex: 0 0 auto;
    }
    .modal-close:active{ transform: scale(0.98); }

    .modal-body{
      padding: 16px 18px 18px;

      /* NEW: scrollable content area */
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      flex: 1 1 auto;
    }

    .field{ display:flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
    .label{
      font-family:'Space Grotesk', monospace;
      font-size: 10px;
      letter-spacing:.16em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.55);
    }
    .input, .select, .textarea{
      width: 100%;
      border-radius: 14px;
      padding: 12px 12px;
      background: rgba(0,0,0,0.40);
      border: 1px solid rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.90);
      outline: none;
    }
    .textarea{ min-height: 92px; resize: vertical; }
    .grid2{ display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media(min-width: 768px){ .grid2{ grid-template-columns: 1fr 1fr; } }

    .modal-actions{
      margin-top: 14px;
      display:flex; gap: 10px; justify-content: flex-end; align-items:center; flex-wrap: wrap;

      /* NEW: sticky action bar */
      position: sticky;
      bottom: 0;
      background: linear-gradient(to top, rgba(10,12,16,0.92), rgba(10,12,16,0.55));
      padding: 12px 0 calc(10px + env(safe-area-inset-bottom));
      border-top: 1px solid rgba(255,255,255,0.08);
    }

    .btn{
      border-radius: 14px;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      color: rgba(255,255,255,0.85);
      font-family:'Space Grotesk', monospace;
      font-size: 11px;
      letter-spacing:.14em;
      text-transform: uppercase;
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
      cursor:pointer;
      user-select:none;
    }
    .btn:active{ transform: scale(0.99); }
    .btn-primary{
      border-color: rgba(99,102,241,0.35);
      background: radial-gradient(120% 120% at 20% 0%, rgba(99,102,241,0.25), rgba(255,255,255,0.03));
      box-shadow: 0 0 34px rgba(99,102,241,0.12), inset 0 0 18px rgba(6,182,212,0.06);
    }
    .btn-primary:hover{
      border-color: rgba(99,102,241,0.55);
      background: radial-gradient(120% 120% at 20% 0%, rgba(99,102,241,0.32), rgba(255,255,255,0.04));
    }
    .hint{
      font-size: 12px;
      color: rgba(255,255,255,0.56);
      margin-right: auto;
      max-width: 28rem;
    }
    .err{ display:none; margin-top: 10px; font-size: 13px; color: rgba(255,120,120,0.9); }
    .err.on{ display:block; }

    @media (max-width: 480px){
      .modal-top{ padding: 14px 14px 10px; }
      .modal-body{ padding: 12px 14px 14px; }
      .modal-sub{ font-size: 13px; }
    }

    @media (prefers-reduced-motion: reduce){
      .module-card, .void-text, .chip, .tip-wrap { transition: none !important; }
      .animate-pulse, .animate-ping { animation: none !important; }
      .zion-thinking span{ animation: none !important; }
    }
  </style>
</head>

<body>
  <div id="canvas-container" aria-hidden="true"></div>
  <div class="vignette" aria-hidden="true"></div>
  <div class="scanlines" aria-hidden="true"></div>

  <!-- Badges -->
  <div class="badge lumen-badge" aria-label="Lumen Labs"><span class="dot"></span>Lumen Labs</div>
  <div class="badge zion-badge" aria-label="Zion version"><span class="dot"></span>Zion 2.0</div>

  <!-- Zion Output (reply only) -->
  <div class="void-output" aria-live="polite" aria-atomic="true">
    <div class="void-inner">
      <div class="void-label"><span class="p"></span><span>ZION</span></div>
      <div id="zion-reply" class="void-text"></div>
    </div>
  </div>

  <!-- ================= MOBILE ================= -->
  <div id="ui-mobile" class="relative z-10 flex flex-col h-screen w-full mx-auto px-5 py-7 box-border">
    <header class="flex-none pt-10 pb-4 text-left">
      <h1 class="font-mono text-4xl font-light tracking-tight text-white mb-2">
        Executive intelligence <span class="text-indigo-400">online.</span>
      </h1>
      <p class="font-sans text-[11px] text-gray-400 tracking-[0.22em] uppercase">
        Zion is active. Awaiting directive.
      </p>
      <p class="mt-3 text-[14px] text-white/70 max-w-[26rem]">
        Tell Zion what you want to grow. Use a pathway if you want a fast start.
      </p>

      <div class="chip-row no-scrollbar" aria-label="Pathways">
        <button type="button" class="chip" data-seed="I need more leads. Where do we start?">Leads</button>
        <button type="button" class="chip" data-seed="I need follow-up automation. Map it out.">Follow-up</button>
        <button type="button" class="chip" data-seed="My operations are messy. Fix the system.">Systems</button>
        <button type="button" class="chip" data-seed="I need content that converts. What do we post?">Content</button>
      </div>
    </header>

    <main class="flex-grow overflow-y-auto no-scrollbar safe-bottom-pad">
      <div id="tipWrap" class="tip-wrap mt-6">
        <div class="text-[11px] font-mono uppercase tracking-[0.18em] text-white/35">Tip</div>
        <div class="mt-2 text-[14px] text-white/70">
          Keep it simple: “I run a (business type) and I want (result).”
        </div>
      </div>
    </main>

    <!-- Dock (mobile) -->
    <div class="fixed bottom-0 left-0 w-full z-30 pb-5 px-4">
      <div class="max-w-xl mx-auto">
        <div class="glass-input rounded-2xl p-4 transition-all duration-300 focus-within:ring-1 focus-within:ring-indigo-500/50 focus-within:shadow-[0_0_30px_rgba(99,102,241,0.15)]">
          <div class="flex items-center gap-3">
            <div class="relative flex items-center justify-center">
              <span class="absolute w-2 h-2 bg-indigo-500 rounded-full animate-ping opacity-75"></span>
              <span class="relative w-2 h-2 bg-indigo-400 rounded-full"></span>
            </div>

            <input
              type="text"
              id="zion-input-mobile"
              class="flex-1 bg-transparent border-none outline-none text-white placeholder-gray-500 font-mono text-sm"
              placeholder="How can Zion assist you today?"
              autocomplete="off"
            />

            <button id="zion-send-mobile" type="button"
              class="w-10 h-10 rounded-xl bg-white/5 active:bg-white/8 border border-white/10 transition-all flex items-center justify-center"
              aria-label="Send">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white/60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
              </svg>
            </button>
          </div>

          <div class="mt-3 flex flex-wrap items-center justify-center gap-x-5 gap-y-2 dock-links">
            <a href="/privacy">Privacy</a>
            <a href="/terms">Terms</a>
            <span class="opacity-30">•</span>
            <a href="https://instagram.com/lumen_labs_atl" target="_blank" rel="noopener noreferrer">Instagram</a>
            <a href="https://www.facebook.com/lumenlabsatl" target="_blank" rel="noopener noreferrer">Facebook</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= DESKTOP ================= -->
  <div id="ui-desktop" class="relative z-10 flex flex-col h-screen w-full max-w-7xl mx-auto px-6 md:px-12 py-8 box-border">
    <header class="flex-none pt-10 md:pt-16 pb-10 md:pb-12 text-center md:text-left">
      <h1 class="font-mono text-4xl md:text-6xl font-light tracking-tight text-white mb-3">
        Executive intelligence <span class="text-indigo-400">online.</span>
      </h1>
      <p class="font-sans text-xs md:text-sm text-gray-400 tracking-[0.22em] uppercase">
        Zion is active. Awaiting directive.
      </p>
      <p class="mt-4 text-sm md:text-base text-white/70 max-w-2xl">
        Tell Zion what you want to grow. If you’re not sure where to start, choose a pathway below.
      </p>
    </header>

    <main class="flex-grow overflow-y-auto no-scrollbar safe-bottom-pad">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5 md:gap-6">
        <button type="button" class="module-card glass-panel rounded-2xl p-6 text-left"
          data-seed="I need more leads. Where do we start?">
          <div class="flex items-center justify-between mb-6">
            <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-indigo-300">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8 0a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2H9v6a1 1 0 1 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z"/>
              </svg>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 status-dot animate-pulse"></span>
              <span class="text-[10px] font-mono text-emerald-500 uppercase tracking-wider">Ready</span>
            </div>
          </div>
          <h3 class="text-lg font-medium text-white mb-2 font-mono">Lead Generation</h3>
          <p class="text-xs text-gray-400 leading-relaxed">Targeting, positioning, landing flows, and conversion lift.</p>
        </button>

        <button type="button" class="module-card glass-panel rounded-2xl p-6 text-left"
          data-seed="I need follow-up automation. Map it out.">
          <div class="flex items-center justify-between mb-6">
            <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-cyan-300">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
              </svg>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 status-dot animate-pulse"></span>
              <span class="text-[10px] font-mono text-indigo-400 uppercase tracking-wider">Active</span>
            </div>
          </div>
          <h3 class="text-lg font-medium text-white mb-2 font-mono">Follow-Up & Automation</h3>
          <p class="text-xs text-gray-400 leading-relaxed">Sequences, scheduling, CRM routing, and nurture.</p>
        </button>

        <button type="button" class="module-card glass-panel rounded-2xl p-6 text-left"
          data-seed="My operations are messy. Fix the system.">
          <div class="flex items-center justify-between mb-6">
            <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-violet-300">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M7.443.184a1.5 1.0 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
              </svg>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-1.5 h-1.5 rounded-full bg-cyan-500 status-dot animate-pulse"></span>
              <span class="text-[10px] font-mono text-cyan-400 uppercase tracking-wider">Standby</span>
            </div>
          </div>
          <h3 class="text-lg font-medium text-white mb-2 font-mono">Operations & Systems</h3>
          <p class="text-xs text-gray-400 leading-relaxed">Process design, automations, governance, and execution clarity.</p>
        </button>

        <button type="button" class="module-card glass-panel rounded-2xl p-6 text-left"
          data-seed="I need content that converts. What do we post?">
          <div class="flex items-center justify-between mb-6">
            <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-rose-300">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"/>
              </svg>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 status-dot"></span>
              <span class="text-[10px] font-mono text-emerald-400 uppercase tracking-wider">Online</span>
            </div>
          </div>
          <h3 class="text-lg font-medium text-white mb-2 font-mono">Content & Growth</h3>
          <p class="text-xs text-gray-400 leading-relaxed">Social systems, creative ops, AI video + music workflows.</p>
        </button>
      </div>
    </main>

    <!-- Dock (desktop) -->
    <div class="fixed bottom-0 left-0 w-full z-30 pb-5 px-4 md:px-0">
      <div class="max-w-3xl mx-auto">
        <div class="glass-input rounded-2xl p-4 md:p-5 transition-all duration-300 focus-within:ring-1 focus-within:ring-indigo-500/50 focus-within:shadow-[0_0_30px_rgba(99,102,241,0.15)]">
          <div class="flex items-center gap-4">
            <div class="relative flex items-center justify-center">
              <span class="absolute w-2 h-2 bg-indigo-500 rounded-full animate-ping opacity-75"></span>
              <span class="relative w-2 h-2 bg-indigo-400 rounded-full"></span>
            </div>

            <input
              type="text"
              id="zion-input-desktop"
              class="flex-1 bg-transparent border-none outline-none text-white placeholder-gray-500 font-mono text-sm md:text-base"
              placeholder="How can Zion assist you today?"
              autocomplete="off"
            />

            <button id="zion-send-desktop" type="button"
              class="w-10 h-10 rounded-xl bg-white/5 hover:bg-white/8 border border-white/10 hover:border-indigo-400/30 transition-all flex items-center justify-center"
              aria-label="Send">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white/60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
              </svg>
            </button>
          </div>

          <div class="mt-3 flex flex-wrap items-center justify-center gap-x-5 gap-y-2 dock-links">
            <a href="/privacy">Privacy</a>
            <a href="/terms">Terms</a>
            <span class="hidden sm:inline opacity-30">•</span>
            <a href="https://instagram.com/lumen_labs_atl" target="_blank" rel="noopener noreferrer">Instagram</a>
            <a href="https://www.facebook.com/lumenlabsatl" target="_blank" rel="noopener noreferrer">Facebook</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Intake Modal ===== -->
  <div id="intakeModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-top">
        <div>
          <div class="modal-title">INTAKE — ZION ACTIVATION</div>
          <div class="modal-sub">
            Quick details so Zion can price accurately and generate your executive summary + service tiers.
          </div>
        </div>
        <button id="closeIntake" class="modal-close" type="button" aria-label="Close">✕</button>
      </div>

      <div class="modal-body">
        <form id="intakeForm">
          <div class="grid2">
            <div class="field">
              <div class="label">Full Name</div>
              <input class="input" id="in_name" name="name" placeholder="Your name" required />
            </div>
            <div class="field">
              <div class="label">Email</div>
              <input class="input" id="in_email" name="email" type="email" placeholder="you@company.com" required />
            </div>
          </div>

          <div class="grid2">
            <div class="field">
              <div class="label">Business Name</div>
              <input class="input" id="in_business" name="business" placeholder="Business name" required />
            </div>
            <div class="field">
              <div class="label">Website (optional)</div>
              <input class="input" id="in_website" name="website" placeholder="https://..." />
            </div>
          </div>

          <div class="grid2">
            <div class="field">
              <div class="label">Industry</div>
              <select class="select" id="in_industry" name="industry" required>
                <option value="" selected disabled>Select…</option>
                <option>Home Services</option>
                <option>Medical / Healthcare</option>
                <option>Real Estate</option>
                <option>Law</option>
                <option>E-Commerce</option>
                <option>Local Retail</option>
                <option>Professional Services</option>
                <option>Creator / Media</option>
                <option>Other</option>
              </select>
            </div>
            <div class="field">
              <div class="label">Primary Goal</div>
              <select class="select" id="in_goal" name="goal" required>
                <option value="" selected disabled>Select…</option>
                <option>More Leads</option>
                <option>Better Follow-Up</option>
                <option>Operations / Systems</option>
                <option>Content that Converts</option>
                <option>SEO / Visibility</option>
                <option>Full Growth System</option>
              </select>
            </div>
          </div>

          <div class="grid2">
            <div class="field">
              <div class="label">Monthly Budget Range (optional)</div>
              <select class="select" id="in_budget" name="budget">
                <option value="" selected>Prefer not to say</option>
                <option>$500–$1,000</option>
                <option>$1,000–$2,500</option>
                <option>$2,500–$5,000</option>
                <option>$5,000+</option>
              </select>
            </div>
            <div class="field">
              <div class="label">Timeline</div>
              <select class="select" id="in_timeline" name="timeline" required>
                <option value="" selected disabled>Select…</option>
                <option>ASAP (0–7 days)</option>
                <option>2–3 weeks</option>
                <option>30 days</option>
                <option>Just exploring</option>
              </select>
            </div>
          </div>

          <div class="field">
            <div class="label">Biggest Bottleneck (1–2 sentences)</div>
            <textarea class="textarea" id="in_bottleneck" name="bottleneck" placeholder="What’s the main thing slowing growth right now?" required></textarea>
          </div>

          <div id="intakeErr" class="err">Something went wrong. Try again.</div>

          <div class="modal-actions">
            <div class="hint">After submission, you’ll get a detailed summary + three tiers.</div>
            <button id="intakeCancel" class="btn" type="button">Not Now</button>
            <button id="intakeSubmit" class="btn btn-primary" type="submit">Generate Summary</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const ZION_ENDPOINT = "https://zion-exec.vercel.app/api/zion";
    const INTAKE_ENDPOINT = "/api/intake";
    const SUMMARY_URL = "/summary.html";

    /* ===== THREE.JS (single init) ===== */
    function initThreeJS() {
      const container = document.getElementById('canvas-container');
      if (!container) return;

      if (container.dataset.ready === "1" && container.querySelector("canvas")) return;
      container.dataset.ready = "1";
      container.innerHTML = "";

      const scene = new THREE.Scene();
      scene.fog = new THREE.FogExp2(0x050505, 0.002);

      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 55;

      const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true, powerPreference: "high-performance" });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
      renderer.domElement.style.width = "100%";
      renderer.domElement.style.height = "100%";
      renderer.domElement.style.display = "block";
      container.appendChild(renderer.domElement);

      const getTexture = () => {
        const c = document.createElement('canvas');
        c.width = 32; c.height = 32;
        const g = c.getContext('2d');
        const r = g.createRadialGradient(16, 16, 0, 16, 16, 16);
        r.addColorStop(0, 'rgba(255,255,255,1)');
        r.addColorStop(0.25, 'rgba(255,255,255,0.7)');
        r.addColorStop(0.6, 'rgba(255,255,255,0.18)');
        r.addColorStop(1, 'rgba(0,0,0,0)');
        g.fillStyle = r;
        g.fillRect(0,0,32,32);
        const t = new THREE.Texture(c);
        t.needsUpdate = true;
        return t;
      };
      const particleTexture = getTexture();

      const starGeometry = new THREE.BufferGeometry();
      const starCount = 2300;
      const starPos = new Float32Array(starCount * 3);
      for (let i = 0; i < starCount * 3; i++) starPos[i] = (Math.random() - 0.5) * 460;
      starGeometry.setAttribute('position', new THREE.BufferAttribute(starPos, 3));

      const starMaterial = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 0.55,
        transparent: true,
        opacity: 0.86
      });
      const starField = new THREE.Points(starGeometry, starMaterial);
      scene.add(starField);

      const cloudGeometry = new THREE.BufferGeometry();
      const cloudCount = 52;
      const cloudPos = new Float32Array(cloudCount * 3);
      const cloudColors = new Float32Array(cloudCount * 3);

      const palette = [
        new THREE.Color(0x6366f1),
        new THREE.Color(0x06b6d4),
        new THREE.Color(0x8b5cf6),
        new THREE.Color(0xc026d3)
      ];

      for (let i = 0; i < cloudCount; i++) {
        cloudPos[i*3]   = (Math.random() - 0.5) * 180;
        cloudPos[i*3+1] = (Math.random() - 0.5) * 125;
        cloudPos[i*3+2] = (Math.random() - 0.5) * 150;

        const col = palette[(Math.random() * palette.length) | 0];
        cloudColors[i*3]   = col.r;
        cloudColors[i*3+1] = col.g;
        cloudColors[i*3+2] = col.b;
      }

      cloudGeometry.setAttribute('position', new THREE.BufferAttribute(cloudPos, 3));
      cloudGeometry.setAttribute('color', new THREE.BufferAttribute(cloudColors, 3));

      const cloudMaterial = new THREE.PointsMaterial({
        size: 28,
        map: particleTexture,
        vertexColors: true,
        transparent: true,
        opacity: 0.14,
        depthWrite: false,
        blending: THREE.AdditiveBlending,
        sizeAttenuation: true
      });

      const cloudSystem = new THREE.Points(cloudGeometry, cloudMaterial);
      scene.add(cloudSystem);

      let mouseX = 0, mouseY = 0;
      let targetX = 0, targetY = 0;

      function setMouse(x, y){
        mouseX = x - window.innerWidth / 2;
        mouseY = y - window.innerHeight / 2;
      }

      document.addEventListener('mousemove', (e) => setMouse(e.clientX, e.clientY), { passive: true });
      document.addEventListener('touchmove', (e) => {
        if (e.touches && e.touches[0]) setMouse(e.touches[0].clientX, e.touches[0].clientY);
      }, { passive: true });

      const clock = new THREE.Clock();
      function animate(){
        requestAnimationFrame(animate);
        const t = clock.getElapsedTime();

        targetX = mouseX * 0.006;
        targetY = mouseY * 0.006;

        camera.position.x += (targetX - camera.position.x) * 0.045;
        camera.position.y += (-targetY - camera.position.y) * 0.045;
        camera.lookAt(scene.position);

        cloudSystem.rotation.y = t * 0.018;
        cloudSystem.rotation.z = t * 0.006;
        starField.rotation.y = t * 0.001;

        renderer.render(scene, camera);
      }
      animate();

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }, { passive: true });

      renderer.domElement.addEventListener("webglcontextlost", (e) => {
        e.preventDefault();
        container.dataset.ready = "0";
        setTimeout(initThreeJS, 350);
      }, false);
    }

    /* ===== Intake Modal Controller ===== */
    function initIntakeModal(){
      const modal = document.getElementById("intakeModal");
      const closeBtn = document.getElementById("closeIntake");
      const cancelBtn = document.getElementById("intakeCancel");
      const form = document.getElementById("intakeForm");
      const err = document.getElementById("intakeErr");
      const submitBtn = document.getElementById("intakeSubmit");

      const KEY = "zion_intake_opened_once";

      function open(){
        if (!modal) return;
        modal.classList.add("on");
        modal.setAttribute("aria-hidden","false");
        if (window.gsap){
          gsap.fromTo(".modal-card", { y: 18, opacity: 0 }, { y: 0, opacity: 1, duration: 0.35, ease: "power2.out" });
        }
        setTimeout(()=> document.getElementById("in_name")?.focus(), 120);
      }

      function close(){
        if (!modal) return;
        modal.classList.remove("on");
        modal.setAttribute("aria-hidden","true");
      }

      function openOnce(){
        if (localStorage.getItem(KEY) === "1") return;
        localStorage.setItem(KEY, "1");
        open();
      }

      closeBtn?.addEventListener("click", close);
      cancelBtn?.addEventListener("click", close);
      modal?.addEventListener("click", (e)=>{ if (e.target === modal) close(); });

      form?.addEventListener("submit", async (e)=>{
        e.preventDefault();
        if (!form) return;

        err.classList.remove("on");
        submitBtn.disabled = true;
        submitBtn.textContent = "Generating…";

        const fd = new FormData(form);
        const payload = Object.fromEntries(fd.entries());

        payload.session_id = window.__ZION_SESSION_ID || "";
        payload.source = "Lumen Landing — Zion Intake";

        try{
          const res = await fetch(INTAKE_ENDPOINT, {
            method: "POST",
            headers: { "Content-Type":"application/json" },
            body: JSON.stringify(payload)
          });
          const data = await res.json().catch(()=>null);
          if (!res.ok || !data || !data.proposal_id) throw new Error("bad intake");

          try{
            localStorage.setItem("zion_last_proposal_id", data.proposal_id);
            if (data.proposal) localStorage.setItem("zion_proposal_" + data.proposal_id, JSON.stringify(data.proposal));
            localStorage.setItem("zion_turn_count_reset", String(Date.now()));
          }catch{}

          close();
          window.location.href = SUMMARY_URL + "?pid=" + encodeURIComponent(data.proposal_id);

        } catch (ex){
          err.classList.add("on");
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = "Generate Summary";
        }
      });

      return { open, close, openOnce };
    }

    /* ===== Zion wiring (reply only + next_question => placeholder + loop guard) ===== */
    function initZion(intakeCtl){
      const replyEl = document.getElementById('zion-reply');
      const tipWrap = document.getElementById("tipWrap");
      const inputMobile = document.getElementById("zion-input-mobile");
      const inputDesktop = document.getElementById("zion-input-desktop");

      const prefersReduced = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      const SESSION_KEY = "zion_session_id";
      const makeId = () => {
        try { return crypto?.randomUUID ? crypto.randomUUID() : String(Date.now()) + "-" + Math.random().toString(16).slice(2); }
        catch { return String(Date.now()) + "-" + Math.random().toString(16).slice(2); }
      };
      const session_id = (localStorage.getItem(SESSION_KEY) || makeId());
      localStorage.setItem(SESSION_KEY, session_id);
      window.__ZION_SESSION_ID = session_id;

      const transcript = [];
      let inFlight = false;

      // Loop guard
      let turnCount = 0;
      try{
        const resetAt = localStorage.getItem("zion_turn_count_reset");
        if (resetAt) turnCount = 0;
      }catch{}

      const defaultPlaceholder = "How can Zion assist you today?";

      function setPlaceholder(text){
        const t = (text || "").trim();
        const ph = t.length ? t : defaultPlaceholder;
        if (inputMobile) inputMobile.placeholder = ph;
        if (inputDesktop) inputDesktop.placeholder = ph;
      }

      function hideTipIfNeeded(){
        if (!tipWrap) return;
        tipWrap.classList.add("tip-hidden");
      }

      function safeJson(text){
        try { return JSON.parse(text); } catch { return null; }
      }

      function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

      function setThinking(el){
        el.classList.add("on");
        el.classList.add("zion-typed");
        el.innerHTML = `
          <span class="zion-thinking" aria-label="Zion is thinking">
            <span></span><span></span><span></span>
          </span>
        `;
      }

      function gsapIn(el){
        if (prefersReduced || !window.gsap) return;
        gsap.killTweensOf(el);
        gsap.fromTo(el,
          { opacity: 0, y: 10, filter: "blur(6px)" },
          { opacity: 1, y: 0, filter: "blur(0px)", duration: 0.46, ease: "power2.out" }
        );
      }

      async function gsapOut(el){
        if (prefersReduced || !window.gsap) return;
        return new Promise(resolve => {
          gsap.killTweensOf(el);
          gsap.to(el, { opacity: 0, duration: 0.18, ease: "power1.out", onComplete: resolve });
        });
      }

      async function typeInto(el, text, opts={}){
        el.classList.add("on");
        el.classList.add("zion-typed");

        if (prefersReduced){
          el.textContent = text || "";
          return;
        }

        const {
          minDelay=10,
          maxDelay=18,
          startDelay=80,
          commaPause=55,
          periodPause=90,
          linePause=80
        } = opts;

        await sleep(startDelay + Math.floor(Math.random()*120));

        el.textContent = "";
        let out = "";
        const s = (text || "");

        for (let i=0; i<s.length; i++){
          const ch = s[i];
          out += ch;
          el.textContent = out;

          let d = minDelay + Math.random()*(maxDelay - minDelay);
          if (ch === ",") d += commaPause;
          if (ch === "." || ch === "!" || ch === "?") d += periodPause;
          if (ch === "\n") d += linePause;

          await sleep(d);
        }
      }

      function normalizeNextQuestion(nextQuestion){
        const raw = (nextQuestion || "").trim();
        if (!raw) return "";
        const firstLine = raw.split(/\n+/)[0].trim();
        const qMark = firstLine.indexOf("?");
        const firstQ = qMark !== -1 ? firstLine.slice(0, qMark + 1) : firstLine;
        return firstQ.replace(/\s+/g, " ").trim();
      }

      async function renderZion(replyText){
        await gsapOut(replyEl);
        setThinking(replyEl);
        gsapIn(replyEl);

        // thinking ~0.7s
        await sleep(700);

        await typeInto(replyEl, (replyText || "").trim(), {
          minDelay: 10,
          maxDelay: 18,
          startDelay: 80,
          commaPause: 55,
          periodPause: 90,
          linePause: 80
        });
      }

      async function callZion(message){
        if (inFlight) return;
        inFlight = true;

        hideTipIfNeeded();
        setPlaceholder(defaultPlaceholder);

        setThinking(replyEl);
        replyEl.classList.add("on");
        gsapIn(replyEl);

        const payload = { message, session_id, transcript: transcript.slice(-18) };

        const t0 = performance.now();
        try{
          const res = await fetch(ZION_ENDPOINT, {
            method: "POST",
            headers: { "Content-Type":"application/json" },
            body: JSON.stringify(payload)
          });

          const raw = await res.text();
          const data = safeJson(raw);

          if (!res.ok || !data || typeof data.reply !== "string") throw new Error("Bad response");

          // Never feel instant/robotic
          const elapsed = performance.now() - t0;
          const minThink = 700;
          if (!prefersReduced && elapsed < minThink) await sleep(minThink - elapsed);

          transcript.push({ role:"user", content: message, ts: Date.now() });
          transcript.push({ role:"zion", content: data.reply, ts: Date.now() });

          // next_question goes inside placeholder
          const ph = normalizeNextQuestion(data.next_question || "");
          if (ph) setPlaceholder(ph);

          await renderZion(data.reply || "");

          // Intake trigger from model
          if (data.capture_intent === "ask_contact" && intakeCtl){
            intakeCtl.openOnce();
          }

          // Loop guard: force intake after N turns
          turnCount += 1;
          const FORCE_INTAKE_AFTER_TURNS = 3;
          if (turnCount >= FORCE_INTAKE_AFTER_TURNS && intakeCtl){
            intakeCtl.openOnce();
          }

        } catch (err){
          setPlaceholder("Confirm endpoint + CORS, then try again.");
          await renderZion("Link unstable. I can’t reach the intelligence layer.");
        } finally {
          inFlight = false;
        }
      }

      function bindInput(inputId, sendId){
        const input = document.getElementById(inputId);
        const send  = document.getElementById(sendId);
        if (!input || !send) return;

        function handleSend(){
          const msg = (input.value || "").trim();
          if (!msg) return;
          input.value = "";
          setPlaceholder(defaultPlaceholder);
          callZion(msg);
        }

        send.addEventListener('click', handleSend);
        input.addEventListener('keydown', (e) => { if (e.key === "Enter") handleSend(); });
      }

      bindInput("zion-input-mobile", "zion-send-mobile");
      bindInput("zion-input-desktop", "zion-send-desktop");

      function activeInput(){
        return window.matchMedia("(min-width: 768px)").matches
          ? document.getElementById("zion-input-desktop")
          : document.getElementById("zion-input-mobile");
      }
      document.querySelectorAll('[data-seed]').forEach(btn => {
        btn.addEventListener('click', () => {
          const seed = (btn.getAttribute('data-seed') || "").trim();
          const input = activeInput();
          if (!input) return;

          input.value = seed;
          requestAnimationFrame(() => {
            input.focus();
            try { input.setSelectionRange(0, 0); } catch {}
            input.scrollLeft = 0;
          });
        });
      });

      // Initial presence
      setTimeout(() => {
        setPlaceholder("Tell me your business + what you want to improve.");
        renderZion("… I’m online.");
      }, 720);
    }

    window.addEventListener("load", () => {
      initThreeJS();
      const intakeCtl = initIntakeModal();
      initZion(intakeCtl);
    });
  </script>
</body>
</html>
